{% extends "overview.twig" %}

{% block content %}
<h1>Source Browser</h1>

<div class="row">
    <div class="span3">
        <h2>Tree</h2>
        {% set dir = tree %}
        {% include "directory.twig" %}
        <h2>Annotations</h2>
        <ul class="annotations unstyled">
        {% for annotation in annotations if annotation.message %}
            <li>
                <a href="#line_{{annotation.line}}">
                    <i class="{% if annotation.class == "warning" %}icon-info-sign{% else %}icon-warning-sign{% endif %}"></i>
                    <span class="analyzer">[{{annotation.type}}]</span>
                    <span class="message">{{annotation.message}}</span>
                </a>
            </li>
        {% endfor %}
        </ul>
    </div>

    <div class="span9">
        <h2>{{path}}</h2>

        {% if dependencies %}
        <table class="table table-striped table-bordered">
            <thead>
                <tr>
                    <th style="width: 25%">Extends</th>
                    <th style="width: 25%">Extended by</th>
                    <th style="width: 25%">Uses</th>
                    <th style="width: 25%">Used by</th>
                </tr>
            </thead>
            <tbody>
                <tr>
                    <td>
                        {% set classes = dependencies.extends %}
                        {% include "source_classlist.twig" %}
                    </td>
                    <td>
                        {% set classes = dependencies.extendedBy %}
                        {% include "source_classlist.twig" %}
                    </td>
                    <td>
                        {% set classes = dependencies.uses %}
                        {% include "source_classlist.twig" %}
                    </td>
                    <td>
                        {% set classes = dependencies.usedBy %}
                        {% include "source_classlist.twig" %}
                        </ul>
                    </td>
                </tr>
            </tbody>
        </table>
        {% endif %}

        <ol class="source">
        {% for line in source %}
            <li id="line_{{loop.index}}" class="
                {%- for annotation in line.annotations -%}
                    {{annotation.type}}-{{annotation.class}}{{" "}}
                {%- endfor -%}
            ">
                <a href="#line_{{loop.index}}">
                    {% if line.messages %}
                    <div class="modal" id="annotation_{{loop.index}}">
                        <div class="modal-header">
                            <button class="close" data-dismiss="modal">Ã—</button>
                            <h3>Annotations</h3>
                        </div>
                        <div class="modal-body">
                            <ul class="annotations unstyled">
                            {% for annotation in line.messages if annotation.message %}
                                <li>
                                    <i class="{% if annotation.class == "warning" %}icon-info-sign{% else %}icon-warning-sign{% endif %}"></i>
                                    <span class="analyzer">[{{annotation.type}}]</span>
                                    <span class="message">{{annotation.message}}</span>
                                </li>
                            {% endfor %}
                            </ul>
                        </div>
                    </div>
                    <a class="icon" data-toggle="modal" href="#annotation_{{loop.index}}">
                        <span class="badge badge-error">{{line.messages|length}}</span>
                    </a>
                    {% endif %}
                    <pre>{% autoescape false %}{{line.content}}{% endautoescape %}</pre>
                </a>
            </li>
        {% endfor %}
        </ol>
    </div>
</div>
{% endblock %}
